<!DOCTYPE html>
<html>
<head>
    <title>Input</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
            integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
            crossorigin="anonymous"></script>
    <script>
        const SIMPLIFIED_JOINTS = [" Pelvis", "Neck", "Head", "Right Upper Arm", "Right Forearm",
            "Right Hand", "Left Upper Arm", "Left Forearm", "Left Hand",
            "Right Upper Leg", "Right Lower Leg", "Right Foot", "Left Upper Leg",
            "Left Lower Leg", "Left Foot"];

        function get_default_weights() {
            let weights = new Map();
            for (let i in SIMPLIFIED_JOINTS) {
                weights.set(SIMPLIFIED_JOINTS[i], 1);
            }
            return weights;
        }


        $(document).ready(function () {
            let chosen_slot = "0";
            let weights_groups = [];
            weights_groups.push(get_default_weights());

            $(document).on("click", ".add", function () {
                let index = Number($(this).val());
                console.log(index)
                index += 1;
                $(this).parent().parent().after(`
    <div class="row mt-3">
        <div class="col col-md-1">
            <button type="button" class="btn btn-primary add" value="${index}">+</button>
        </div>
        <div class="col motion_0 col-md-6">
            <input type="number" class="form-control" placeholder="Node of Motion 0">
        </div>
        <div class="col col-md-1" style="padding: 0">
            <button type="button" class="btn btn-primary set_weights" value="${index}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                     class="bi bi-gear" viewBox="0 0 16 16">
                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                </svg>
            </button>
        </div>
        <div class="col col-md-1">
            <button type="button" class="btn btn-danger sub" value="${index}">-</button>
        </div>
    </div>
    `)

                weights_groups.push(get_default_weights())


            })
            $(document).on("click", ".sub", function () {
                $(this).parent().parent().remove()
                let index = Number($(this).val())
                weights_groups.splice(index, 1)
            })
            $(document).on("click", ".set_weights", function () {
                chosen_slot = $(this).val()
                $('.weight_input input').each(function () {
                    let index = Number(chosen_slot);
                    let key = $(this).attr("id");
                    let value = weights_groups[index].get(key);
                    $(this).val(value);

                });
            })
            $('.weight_input input').change(function () {
                let index = Number(chosen_slot);
                let key = $(this).attr("id");
                let value = Number($(this).val());
                console.log("key:" + key + " val:" + $(this).val());
                weights_groups[index].set(key, value);
            });
            $("#submit").click(function () {

                $('.loader').css("display", "block");
                $('.container').css("opacity", "0.4")

                let marks_motion_0 = [];
                $('.motion_0 input').each(function () {
                    marks_motion_0.push($(this).val());
                });

                let marks_motion_1 = []
                $('.motion_1 input').each(function () {
                    marks_motion_1.push($(this).val());
                });

                let st_weights_groups = []
                for (let i in weights_groups) {
                    st_weights_groups.push(JSON.stringify(Object.fromEntries(weights_groups[i])));
                }

                let flag_visualized_velocity = $("#flag_visualized_velocity").val();
                let flag_heatmap = $("#flag_heatmap").val();
                let file_name_0 = $("#recording_name_0").val();
                let file_name_1 = $("#recording_name_1").val();
                let label_motion_0 = $("#label_motion_0").val();
                let label_motion_1 = $("#label_motion_1").val();

                $.redirectPost('http://127.0.0.1:5000/result',
                    {
                        "marks_motion_0[]": marks_motion_0,
                        "marks_motion_1[]": marks_motion_1,
                        "weights_groups[]": st_weights_groups,
                        "flag_visualized_velocity": flag_visualized_velocity,
                        "flag_heatmap": flag_heatmap,
                        "file_name_0": file_name_0,
                        "file_name_1": file_name_1,
                        "label_motion_0": label_motion_0,
                        "label_motion_1": label_motion_1,
                    }
                );

            });

            let mannequin_wight = $("#weights").width();
            let mannequin_height = mannequin_wight * (914 / 670) //The resolution of the original image is 670 * 914
            $("#weights").css("height", mannequin_height + "px");
            $("#weights").css("background-size", mannequin_wight + "px " + mannequin_height + "px");

            let str_recording_names = "{{recording_names}}";
            console.log(str_recording_names)
            console.log("{{recording_names}}")
            let recording_names = str_recording_names.replace("[&#39;", "").replace("&#39;]", "").split("&#39;, &#39;");

            for (let i in recording_names) {

                $("#recording_name_1").append("<option value=" + recording_names[i] + ">" + recording_names[i] + "</option>");
            }
        })
        $.extend({
            redirectPost: function (location, args) {

                let form = $('<form></form>');
                form.attr("method", "post");
                form.attr("action", location);

                $.each(args, function (key, value) {
                    if (key.includes("[]")) {
                        for (const element of value) {
                            let field = $('<input></input>');
                            field.attr("type", "hidden");
                            field.attr("name", key);
                            field.attr("value", element);
                            form.append(field);
                        }
                    } else {
                        let field = $('<input></input>');
                        field.attr("type", "hidden");
                        field.attr("name", key);
                        field.attr("value", value);
                        form.append(field);
                    }


                });
                $(form).appendTo('body').submit();
            }
        });

        window.onresize = function () {
            let mannequin_wight = $("#weights").width();
            let mannequin_height = mannequin_wight * (914 / 670) //The resolution of the original image is 670 * 914
            $("#weights").css("height", mannequin_height + "px");
            $("#weights").css("background-size", mannequin_wight + "px " + mannequin_height + "px");
        }
    </script>
    <style>
        .weight_input {
            width: 15%;
            position: absolute;
        }

        .loader {
            position: absolute;
            margin: auto;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #0d6efc;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
            display: none;
        }

        /* Safari */
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }


    </style>
</head>
<body>

<div class="loader"></div>

<div id="chartdiv"></div>
<script src="static/script.js?v=5"></script>

<div class="container mt-3 col-md-8">

    <div class="row">
        <div class="col col-md-6 offset-1">
            <!--the names of the motion 0-->
            <div class="row mt-3">
                <div class="col offset-1 col-md-6">
                    <label for="recording_name_0" class="form-label">Recording For Motion 0:</label>
                    <select class="form-select recording_name_select" id="recording_name_0"> </select>
                </div>
            </div>
            <!--start of motion 0-->
            <div class="row mt-3">
                <div class="col col-md-1">
                    <button type="button" class="btn btn-primary add" value="0">+</button>
                </div>
                <div class="col motion_0 col-md-6">
                    <input type="number" class="form-control" placeholder="Start of Motion 0">
                </div>
                <div class="col col-md-1" style="padding: 0">
                    <button type="button" class="btn btn-primary set_weights" value="0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-gear" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <!--the marks between start and end are dynamically added by JS-->
            <!--end of motion 0-->
            <div class="row mt-3">
                <div class="col motion_0 offset-1 col-md-6">
                    <input type="number" class="form-control" placeholder="End of Motion 0">
                </div>
                <!--  <div class="col motion_1">
                      <input type="number" class="form-control" placeholder="End of Motion 1">
                  </div>-->
            </div>
            <!--labels of motion 0-->
            <div class="row mt-3">
                <div class="col col-md-6 offset-1">
                    <input type="text" id="label_motion_0" class="form-control" placeholder="Label of Motion 0">
                </div>
            </div>
            <!--the names of the motion 1-->
            <div class="row mt-3">
                <div class="col col-md-6 offset-1">
                    <label for="recording_name_1" class="form-label">Recording For Motion 1:</label>
                    <select class="form-select recording_name_select" id="recording_name_1"> </select>
                </div>
            </div>
            <!--start of motion 1-->
            <div class="row mt-3">
                <div class="col motion_1 col-md-6 offset-1">
                    <input type="number" class="form-control" placeholder="Start of Motion 1">
                </div>
            </div>
            <!--end of motion 1-->
            <div class="row mt-3">
                <div class="col motion_1 col-md-6 offset-1">
                    <input type="number" class="form-control" placeholder="End of Motion 1">
                </div>
            </div>
            <!--labels of motion 0-->
            <div class="row mt-3">
                <div class="col col-md-6 offset-1">
                    <input type="text" id="label_motion_1" class="form-control" placeholder="Label of Motion 1">
                </div>
            </div>
            <!--flag_visualized_velocity-->
            <div class="row mt-3">
                <div class="col col-md-6 offset-1">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flag_visualized_velocity" value="no">
                        <label class="form-check-label" for="flag_visualized_velocity">With Visualized Velocity</label>
                    </div>
                </div>
            </div>
            <!--flag_heatmap-->
            <div class="row mt-3">
                <div class="col offset-1">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flag_heatmap" value="yes" checked>
                        <label class="form-check-label" for="flag_heatmap">With Heatmap</label>
                    </div>
                </div>
            </div>
            <!--submit button-->
            <div class="mt-3 offset-1">
                <button id="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
        <!--input-fields for weights-->
        <div class="col col-md-5 mt-3" id="weights"
             style="background-image: url('static/mannequin.jpg'); position: relative; padding: 0">
            <div class="weight_input" style="left: 42.4%; top:5%">
                <input type="number" class="form-control" value="1" name="weight" id="Head">
            </div>
            <div class="weight_input" style="left: 20%;top: 20%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Upper Arm">
            </div>
            <div class="weight_input" style="left: 42.4%;top: 15%">
                <input type="number" class="form-control" value="1" name="weight" id="Neck">
            </div>
            <div class="weight_input" style="left: 65%;top: 20%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Upper Arm">
            </div>
            <div class="weight_input" style="left: 19.5%;top: 35%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Forearm">
            </div>
            <div class="weight_input" style="left: 65.5%;top: 35%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Forearm">
            </div>
            <div class="weight_input" style="left: 18%;top: 55%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Hand">
            </div>
            <div class="weight_input" style="left: 67%;top: 55%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Hand">
            </div>
            <div class="weight_input" style="left: 34%;top: 52%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Upper Leg">
            </div>
            <div class="weight_input" style="left: 42.4%;top: 45%">
                <input type="number" class="form-control" value="1" name="weight" id="Pelvis">
            </div>
            <div class="weight_input" style="left: 51%;top: 52%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Upper Leg">
            </div>
            <div class="weight_input" style="left: 33.5%;top: 68%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Lower Leg">
            </div>
            <div class="weight_input" style="left: 51.5%;top: 68%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Lower Leg">
            </div>
            <div class="weight_input" style="left: 33%;top: 93%">
                <input type="number" class="form-control" value="1" name="weight" id="Right Foot">
            </div>
            <div class="weight_input" style="left: 52%;top: 93%">
                <input type="number" class="form-control" value="1" name="weight" id="Left Foot">
            </div>
        </div>

    </div>

</div>


</body>
</html>